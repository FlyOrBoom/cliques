  <!doctype html>
<html>
  <head>
    <title>Cliques!</title>
    <style>
/**{transition-duration:0.01s;}*/
html,body{
  width:100%;
  height:100%;
  overflow:hidden;
  margin:0;
  background:#eee;
}
button{
  z-index:200;
}
#card-container{
  position:fixed;
  display:flex;
  flex-flow:column wrap;
  align-items:center;
  align-content:flex-end;
  justify-content:center;
  filter:drop-shadow(0 0 .4vw #ccc);
  
}
#card-container>*{
  flex:0 0 0;
  border-radius:2vh;
  background:#f8f8f8;
  text-align:center;
  cursor:pointer;
}
#card-container>*:hover{
  background:#fff;
  box-shadow:0 0 3vw 1vw #ccc;
  z-index:100;
}
#card-container>*:hover.selected{
  background:#fff;
  box-shadow:0 0 .5vw #ccc;
}
#card-container>*.selected{
  border-radius:1.8vh;
  background:#f8f8f8;
}
@media (min-aspect-ratio:1/1){
  #card-container{
    width:64vw;
    height:100%;
    right:16.5vw;
  }
  #card-container.stretch{
    width:80vw;
    right:.5vw;
  }
  #card-container>*{
    width:15vw;
    flex-basis:30vh;
    max-height:30vh;
    margin:.5vw;
  }
  #card-container>*.selected{
    width:12vw;
    flex-basis:calc(30vh - 3vw);
    max-height:calc(30vh - 3vw);
    margin:2vw;
  }
  .svg{
    transform:rotate(90deg);
  }
}
@media (max-aspect-ratio:1/1){
  #card-container>*{
    margin:0;
    flex-basis:18vh;
  }
}
.svg{
  width:83.33%;
  height:100%;
  display:inline-block;
  stroke-width:5px;
  pointer-events:none;
}
.color0{
  fill:#f00;
  stroke:#f00;
}
.color1{
  fill:#0f0;
  stroke:#0f0;
}
.color2{
  fill:#00f;
  stroke:#00f;
}
.opacity0{
  fill-opacity:0;
}
.opacity1{
  fill-opacity:.5;
}
.opacity2{
  fill-opacity:1;
}
    </style>
  </head>
  <body>
    <div id='card-container'></div>
    <button id='add' onclick='add();'>new</button>
    <svg>
      <!--
      0: rounded rectangle
      1: squiggle
      2: diamond
      -->
      <symbol id='s00'>
      <rect x='5' y='60' width='130' height='40' rx='20'/>
      </symbol>
      <symbol id='s10'>
      <use href='#s00' transform='translate(0 -25)'/>
      <use href='#s00' transform='translate(0 25)'/>
      </symbol>
      <symbol id='s20'>
      <use href='#s10' transform='translate(0 -25)'/>
      <use href='#s00' transform='translate(0 50)'/>
      </symbol>
      <symbol id='s01'>
      <path d='M5 75 c 0 0 25 -20 40 -20 c 15 0 35 15 50 15  c 15 0 40 -10 40 -10 v 15 c 0 0 -25 20 -40 20 c -15 0 -35 -15 -50 -15 c -15 0 -40 10 -40 10 z'/>
      </symbol>
      <symbol id='s11'>
      <use href='#s01' transform='translate(0 -25)'/>
      <use href='#s01' transform='translate(0 25)'/>
      </symbol>
      <symbol id='s21'>
      <use href='#s11' transform='translate(0 -25)'/>
      <use href='#s01' transform='translate(0 50)'/>
      </symbol>
      <symbol id='s02'>
      <path d='M10 80 l 60 -20 l 60 20 l -60 20 z'/>
      </symbol>
      <symbol id='s12'>
      <use href='#s02' transform='translate(0 -25)'/>
      <use href='#s02' transform='translate(0 25)'/>
      </symbol>
      <symbol id='s22'>
      <use href='#s12' transform='translate(0 -25)'/>
      <use href='#s02' transform='translate(0 50)'/>
      </symbol>
    </svg>
    <script>

//0:color
//1:opacity
//2:parts
//3:shape

var container=document.getElementById('card-container'),
    card=[],
    svg=[],
    use=[],
    color=['#f00','#0f0','#00f'],
    
    selected=[],
    
    count=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],
    
    tick=0;
    
    
const allEqual = arr => arr.every( v => v === arr[0] ) //if all of an array are equal

function isSet(){
  if((count[0].includes(3)||allEqual(count[0]))&&(count[1].includes(3)||allEqual(count[1]))&&(count[2].includes(3)||allEqual(count[2]))&&(count[3].includes(3)||allEqual(count[3]))){
    for(var j=0;j<3;j++){
      container.removeChild(selected[0]);
      if(tick<1){
        randomCard();
      }
    }
    tick=0;
    container.classList='';
    console.log('set!');
  }else{
    for(var j=0;j<card.length;j++){
      card[j].classList='';
    }
  }
  count=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];
}

function randomCard(last){
  var rand = Math.floor(card.length*Math.random());
  if(card[rand].style.display=='none'){
    card[rand].style.display='block';
    card[rand].style.order=Math.floor(99*Math.random());
    if(last==true){
      card[rand].style.order+=99;
    }
    card[rand].addEventListener('click',function(){
      if(card[rand].classList=='selected'){
        card[rand].classList='';
        count[0][card[rand][0]]--;
        count[1][card[rand][1]]--;
        count[2][card[rand][2]]--;
        count[3][card[rand][3]]--;
      }else{
        card[rand].classList='selected';
        count[0][card[rand][0]]++;
        count[1][card[rand][1]]++;
        count[2][card[rand][2]]++;
        count[3][card[rand][3]]++;
        selected = document.getElementsByClassName('selected');
        if(selected.length>2){
          setInterval(isSet,150);
        }
      }
    })
  }else{
    randomCard(last);
  }
}

function add(){
  if(tick<1){
    for(var k = 0;k<3;k++){
      randomCard(true);
    }
    tick=1;
  }
  container.classList='stretch';
}

for(var i = 0;i<81;i++){
  card[i] = document.createElement('div');
  card[i][0] = i%3;
  card[i][1] = Math.floor(i%9/3);
  card[i][2] = Math.floor(i%27/9);
  card[i][3] = Math.floor(i%81/27);
  card[i].title = card[i][0]+'-'+card[i][1]+'-'+card[i][2]+'-'+card[i][3];
  
  svg[i] = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg[i].setAttribute('viewBox','0 0 140 160');
  svg[i].classList='svg color'+card[i][0]+' opacity'+card[i][1];
  
  use[i] = document.createElementNS('http://www.w3.org/2000/svg','use');
  use[i].setAttribute('href','#s'+card[i][2]+card[i][3]);
  
  svg[i].appendChild(use[i]);
  card[i].appendChild(svg[i]);
  
  card[i].style.display='none';

  container.appendChild(card[i]);
}

for(var i = 0;i<12;i++){
  randomCard();
}
    </script>
  </body>
</html>